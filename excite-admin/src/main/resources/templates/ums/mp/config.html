<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>公众号配置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <link rel="stylesheet" href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">
        <!-- 表单 -->
        <form class="layui-form layuimini-form" lay-filter="form-mpConfig-save">
            <!-- 【基本信息配置】提示信息 -->
            <div class="layui-card-body">
                <div class="layui-collapse">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title"><b> 公众号基本信息配置（点击查看说明）</b></h2>
                        <div class="layui-colla-content">
                            请登录 <a href="https://mp.weixin.qq.com/" target="_blank">公众号后台</a> → 设置与开发 → 公众号设置 页面查看公众号基本信息。
                        </div>
                    </div>
                </div>
            </div>
            <!-- 公众号名称 -->
            <div class="layui-form-item">
                <label class="layui-form-label required">公众号名称</label>
                <div class="layui-input-block">
                    <input type="text" name="name" th:value="${mpConfig.name}" lay-verify="required" lay-reqtext="公众号名称不能为空！"
                           placeholder="请输入公众号名称"
                           class="layui-input" autocomplete="off">
                </div>
            </div>
            <!-- 原始ID -->
            <div class="layui-form-item">
                <label class="layui-form-label required">原始ID</label>
                <div class="layui-input-block">
                    <input type="text" name="originalId" th:value="${mpConfig.originalId}" lay-verify="required" lay-reqtext="原始ID不能为空！" placeholder="请输入原始ID"
                           class="layui-input" autocomplete="off">
                </div>
            </div>
            <!-- 公众号类型 -->
            <div class="layui-form-item">
                <label class="layui-form-label required">公众号类型</label>
                <div class="layui-input-inline">
                    <input type="radio" name="type" th:checked="*{mpConfig.type} eq '订阅号'" value="订阅号" title="订阅号">
                    <input type="radio" name="type" th:checked="*{mpConfig.type} eq '服务号'" value="服务号" title="服务号">
                </div>
                <!-- 公众号认证状态 -->
                <label class="layui-form-label required">认证状态</label>
                <div class="layui-input-inline">
                    <input type="radio" name="verified" th:checked="*{mpConfig.verified} eq true" value="true" title="已认证">
                    <input type="radio" name="verified" th:checked="*{mpConfig.verified} eq false" value="false" title="未认证">
                </div>
            </div>

            <!-- 【开发者信息】 -->
            <div class="layui-card-body">
                <div class="layui-collapse">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title"><b> 开发者信息配置（点击查看说明）</b></h2>
                        <div class="layui-colla-content">
                            请登录 <b><a href="https://mp.weixin.qq.com/" target="_blank">公众号后台</a> → 设置与开发 → 基本配置</b> 页面查看公众号基本信息。
                        </div>
                    </div>
                </div>
            </div>
            <!-- 开发者ID -->
            <div class="layui-form-item">
                <label class="layui-form-label required">开发者ID</label>
                <div class="layui-input-block">
                    <input type="text" name="appid" th:value="${mpConfig.appid}" lay-verify="required" lay-reqtext="开发者ID 不能为空！" placeholder="请输入 开发者ID(AppID)"
                           class="layui-input" autocomplete="off">
                </div>
            </div>
            <!-- 开发者密码 -->
            <div class="layui-form-item">
                <label class="layui-form-label required">开发者密码</label>
                <div class="layui-input-block">
                    <input type="text" name="appSecret" th:value="${mpConfig.appSecret}" lay-verify="required" lay-reqtext="开发者密码 不能为空！" placeholder="请输入 开发者密码(AppSecret)"
                           class="layui-input" autocomplete="off">
                </div>
            </div>

            <!-- 服务器配置 -->
            <div class="layui-card-body">
                <div class="layui-collapse">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title"><b> 服务器配置（点击查看说明）</b></h2>
                        <div class="layui-colla-content">
                            请登录 <a href="https://mp.weixin.qq.com/" target="_blank">公众号后台</a> → 设置与开发 → 公众号设置 页面查看公众号基本信息。
                            记得将服务器的IP添加至白名单。
                        </div>
                    </div>
                </div>
            </div>
            <!-- 服务器地址 -->
            <div class="layui-form-item">
                <label class="layui-form-label">服务器地址</label>
                <div class="layui-input-block">
                    <input type="text"
                           th:value="${#httpServletRequest.getScheme() + '://' + #httpServletRequest.getServerName() + '/api/mp/event'}"
                           readonly="readonly" class="layui-input">
                    <tip>登录微信公众平台，访问 [设置与开发 > 基本配置 > 服务器配置]，填写此服务器地址。</tip>
                </div>
            </div>
            <!-- 令牌 -->
            <div class="layui-form-item">
                <label class="layui-form-label">令牌</label>
                <div class="layui-input-block">
                    <input type="text" name="token" th:value="${mpConfig.token}" lay-verify="required" lay-reqtext="开发者密码 不能为空！" placeholder="请输入 开发者密码(AppSecret)"
                           class="layui-input" autocomplete="off">
                    <tip>[令牌] 必须为英文或数字，长度为 3-32，区分大小写。不填默认为"GeekLabUmsMPCenter"</tip>
                </div>
            </div>
            <!-- 解密秘钥 -->
            <div class="layui-form-item">
                <label class="layui-form-label">消息加解密秘钥</label>
                <div class="layui-input-block">
                    <input type="text" name="aesKey" th:value="${mpConfig.aesKey}" lay-verify="required" lay-reqtext="开发者密码 不能为空！" placeholder="请输入 开发者密码(AppSecret)"
                           class="layui-input" autocomplete="off">
                    <tip>[消息加解密秘钥] 由43位字符组成，可随机修改，字符范围为A-Z，a-z，0-9。建议通过微信公众平台 [随机生成]。</tip>
                </div>
            </div>
            <!-- 加密方式 -->
            <div class="layui-form-item">
                <label class="layui-form-label">消息加解密方式</label>
                <div class="layui-input-block">
                    <input type="radio" name="encryptionType" th:checked="*{mpConfig.encryptionType} eq '0'" value="0" title="明文模式" checked>
                    <input type="radio" name="encryptionType" th:checked="*{mpConfig.encryptionType} eq '1'" value="1" title="兼容模式">
                    <input type="radio" name="encryptionType" th:checked="*{mpConfig.encryptionType} eq '2'" value="2" title="安全模式">
                </div>
            </div>

            <!-- 保存按钮 -->
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="form-mpConfig-save">立即保存</button>
                </div>
            </div>
        </form>


    </div>
</div>
<!--引入JS文件-->
<script src="/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="/js/lay-config.js?v=1.0.4" charset="utf-8"></script>

<script>
    layui.use(['table', 'upload'], function () {
        let $ = layui.jquery,
            form = layui.form,
            upload = layui.upload,
            laydate = layui.laydate,
            table = layui.table;

        // 保存配置
        form.on('submit(form-mpConfig-save)', function (data) {
            console.log(JSON.stringify(data.field))
            layer.load();
            $.post("/ums/mp/config/save", data.field, function (data) {
                layer.closeAll('loading');
                if (data.code === 200) {
                    layer.alert(data.msg, {icon: 1});
                } else {
                    layer.alert(data.msg, {icon: 2});
                }
            });
            return false;
        });

    });
</script>
</body>
</html>